generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Employee {
  id                   String                  @id @default(cuid())
  firstName            String
  lastName             String
  email                String                  @unique
  department           String
  position             String
  salary               String
  password             String
  role                 String                  @default("employee")
  createdAt            DateTime                @default(now())
  updatedAt            DateTime                @updatedAt
  address              String
  birthDate            DateTime
  civilStatus          String
  contractType         String
  hireDate             DateTime
  identityCard         String                  @unique
  phone                String
  vacationDays         Int                     @default(15)
  accountNumber        String?
  accountType          String?
  bankName             String?
  exitDate             DateTime?
  exitReason           String?
  exitType             String?
  isActive             Boolean                 @default(true)
  absences             AbsenceRequest[]
  attendance           Attendance[]
  candidateEvaluations CandidateEvaluation[]
  contracts            Contract[]
  documents            Document[]
  benefits             EmployeeBenefit[]
  evaluations          EmployeeEvaluation[]
  goals                EmployeeGoal[]
  schedules            EmployeeSchedule[]
  reviewedEvaluations  EvaluationReviewer[]
  interviews           Interview[]
  postedVacancies      JobVacancy[]
  preferences          NotificationPreference?
  notifications        Notification[]
  PayrollDetail        PayrollDetail[]
  skills               Skill[]
  workHistory          WorkHistory[]

  @@index([email])
  @@index([department])
  @@map("employees")
}

model EmployeeGoal {
  id           String   @id @default(uuid())
  employeeId   String
  title        String
  description  String?
  metric       String   @default("Manual")
  targetValue  Float
  currentValue Float    @default(0)
  unit         String   @default("%")
  deadline     DateTime
  priority     String   @default("MEDIUM")
  status       String   @default("PENDING")
  progress     Float    @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  employee     Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@map("employee_goals")
}

model AbsenceRequest {
  id           String   @id @default(cuid())
  type         String
  startDate    DateTime
  endDate      DateTime
  reason       String
  status       String   @default("PENDING")
  evidenceUrl  String?
  adminComment String?
  employeeId   String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  employee     Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@map("absence_requests")
}

model Attendance {
  id               String    @id @default(cuid())
  date             DateTime
  checkIn          DateTime
  checkOut         DateTime?
  workedHours      Float?
  status           String
  employeeId       String
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  entryLatitude    Float?
  entryLongitude   Float?
  exitLatitude     Float?
  exitLongitude    Float?
  breakEnd         DateTime?
  breakStart       DateTime?
  isEarlyDeparture Boolean   @default(false)
  isLate           Boolean   @default(false)
  overtimeHours    Float?    @default(0)
  employee         Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, date])
  @@index([employeeId])
  @@index([date])
  @@map("attendance")
}

model Shift {
  id               String             @id @default(cuid())
  name             String
  startTime        String
  endTime          String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  breakMinutes     Int                @default(60)
  toleranceMinutes Int                @default(15)
  schedules        EmployeeSchedule[]

  @@map("shifts")
}

model EmployeeSchedule {
  id         String    @id @default(cuid())
  employeeId String
  shiftId    String
  startDate  DateTime
  endDate    DateTime?
  daysOfWeek String
  isActive   Boolean   @default(true)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  employee   Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  shift      Shift     @relation(fields: [shiftId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([shiftId])
  @@map("employee_schedules")
}

model Skill {
  id         String   @id @default(cuid())
  name       String
  level      String
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@map("skills")
}

model WorkHistory {
  id          String    @id @default(cuid())
  company     String
  position    String
  startDate   DateTime
  endDate     DateTime?
  description String?
  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@map("work_history")
}

model AuditLog {
  id          String   @id @default(cuid())
  entity      String
  entityId    String
  action      String
  performedBy String
  details     String
  timestamp   DateTime @default(now())

  @@index([entityId])
  @@map("audit_logs")
}

model Contract {
  id                String    @id @default(cuid())
  type              String
  startDate         DateTime
  endDate           DateTime?
  salary            Float
  clauses           String?
  documentUrl       String?
  status            String    @default("Active")
  employeeId        String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  hasDoubleOvertime Boolean   @default(true)
  hasNightSurcharge Boolean   @default(true)
  employee          Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@map("contracts")
}

model Document {
  id           String    @id @default(cuid())
  type         String
  employeeId   String
  createdAt    DateTime  @default(now())
  documentUrl  String
  expiryDate   DateTime?
  mimeType     String?
  originalName String?
  employee     Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@map("documents")
}

model PayrollConfig {
  id          String        @id @default(cuid())
  workingDays Int           @default(30)
  currency    String        @default("USD")
  validFrom   DateTime      @default(now())
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  items       PayrollItem[]

  @@map("payroll_configs")
}

model PayrollItem {
  id          String        @id @default(cuid())
  name        String
  type        String
  isMandatory Boolean       @default(false)
  percentage  Float?
  fixedValue  Float?
  configId    String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  config      PayrollConfig @relation(fields: [configId], references: [id], onDelete: Cascade)

  @@index([configId])
  @@map("payroll_items")
}

model Payroll {
  id          String          @id @default(cuid())
  period      DateTime
  endDate     DateTime
  status      String          @default("DRAFT")
  totalAmount Float
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  paymentDate DateTime?
  details     PayrollDetail[]

  @@map("payrolls")
}

model PayrollDetail {
  id             String   @id @default(cuid())
  payrollId      String
  employeeId     String
  baseSalary     Float
  workedDays     Int
  overtimeHours  Float
  overtimeAmount Float
  bonuses        String
  deductions     String
  netSalary      Float
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  employee       Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  payroll        Payroll  @relation(fields: [payrollId], references: [id], onDelete: Cascade)

  @@index([payrollId])
  @@index([employeeId])
  @@map("payroll_details")
}

model EmployeeBenefit {
  id         String   @id @default(cuid())
  name       String
  amount     Float
  type       String
  frequency  String
  status     String   @default("ACTIVE")
  employeeId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@map("employee_benefits")
}

model EvaluationTemplate {
  id           String               @id @default(cuid())
  title        String
  description  String?
  period       String
  instructions String?
  criteria     String
  scale        String
  isActive     Boolean              @default(true)
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  evaluations  EmployeeEvaluation[]

  @@map("evaluation_templates")
}

model EmployeeEvaluation {
  id         String               @id @default(cuid())
  templateId String
  employeeId String
  startDate  DateTime
  endDate    DateTime
  status     String               @default("PENDING")
  finalScore Float?
  feedback   String?
  createdAt  DateTime             @default(now())
  updatedAt  DateTime             @updatedAt
  employee   Employee             @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  template   EvaluationTemplate   @relation(fields: [templateId], references: [id])
  reviewers  EvaluationReviewer[]

  @@index([templateId])
  @@index([employeeId])
  @@map("employee_evaluations")
}

model EvaluationReviewer {
  id           String             @id @default(cuid())
  evaluationId String
  reviewerId   String
  status       String             @default("PENDING")
  responses    String?
  comments     String?
  score        Float?
  completedAt  DateTime?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  evaluation   EmployeeEvaluation @relation(fields: [evaluationId], references: [id], onDelete: Cascade)
  reviewer     Employee           @relation(fields: [reviewerId], references: [id])

  @@index([evaluationId])
  @@index([reviewerId])
  @@map("evaluation_reviewers")
}

model JobVacancy {
  id                 String           @id @default(cuid())
  title              String
  department         String
  description        String
  requirements       String
  benefits           String?
  salaryMin          Float?
  salaryMax          Float?
  currency           String           @default("USD")
  location           String
  employmentType     String
  deadline           DateTime
  status             String           @default("OPEN")
  postedById         String
  evaluationCriteria Json?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  applications       JobApplication[]
  postedBy           Employee         @relation(fields: [postedById], references: [id])

  @@index([postedById])
  @@map("job_vacancies")
}

model JobApplication {
  id          String                @id @default(cuid())
  vacancyId   String
  firstName   String
  lastName    String
  email       String
  phone       String
  resumeUrl   String
  coverLetter String?
  status      String                @default("PENDING")
  createdAt   DateTime              @default(now())
  updatedAt   DateTime              @updatedAt
  notes       ApplicationNote[]
  evaluations CandidateEvaluation[]
  interviews  Interview[]
  vacancy     JobVacancy            @relation(fields: [vacancyId], references: [id], onDelete: Cascade)

  @@index([vacancyId])
  @@map("job_applications")
}

model ApplicationNote {
  id            String         @id @default(cuid())
  applicationId String
  content       String
  createdBy     String
  createdById   String
  createdAt     DateTime       @default(now())
  application   JobApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
  @@map("application_notes")
}

model Interview {
  id            String         @id @default(cuid())
  applicationId String
  date          DateTime
  type          String
  location      String?
  interviewerId String
  notes         String?
  status        String         @default("SCHEDULED")
  createdAt     DateTime       @default(now())
  application   JobApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  interviewer   Employee       @relation(fields: [interviewerId], references: [id])

  @@index([applicationId])
  @@index([interviewerId])
  @@map("interviews")
}

model CandidateEvaluation {
  id             String         @id @default(cuid())
  applicationId  String
  evaluatorId    String
  ratings        Json
  comments       String
  recommendation String
  overallScore   Float
  createdAt      DateTime       @default(now())
  application    JobApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  evaluator      Employee       @relation(fields: [evaluatorId], references: [id])

  @@index([applicationId])
  @@map("candidate_evaluations")
}

model ClimateSurvey {
  id          String            @id @default(cuid())
  title       String
  startDate   DateTime
  endDate     DateTime?
  isActive    Boolean           @default(true)
  description String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  responses   ClimateResponse[]

  @@map("climate_surveys")
}

model ClimateResponse {
  id         String        @id @default(cuid())
  surveyId   String
  department String?
  ratings    String
  comments   String?
  npsScore   Int?
  createdAt  DateTime      @default(now())
  survey     ClimateSurvey @relation(fields: [surveyId], references: [id], onDelete: Cascade)

  @@index([surveyId])
  @@map("climate_responses")
}

model Notification {
  id              String   @id @default(cuid())
  recipientId     String
  title           String
  message         String
  type            String
  isRead          Boolean  @default(false)
  relatedEntityId String?
  relatedEntity   String?
  createdAt       DateTime @default(now())
  recipient       Employee @relation(fields: [recipientId], references: [id], onDelete: Cascade)

  @@index([recipientId])
  @@map("notifications")
}

model NotificationPreference {
  id          String   @id @default(cuid())
  employeeId  String   @unique
  preferences Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  employee    Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("notification_preferences")
}

model SystemSetting {
  id                   String    @id @default(cuid())
  maintenanceMode      Boolean   @default(false)
  maintenanceScheduled DateTime?
  maintenanceMessage   String?
  updatedAt            DateTime  @updatedAt

  @@map("system_settings")
}
